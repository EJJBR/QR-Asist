{% extends "base.html" %}

{% block title %}Consolidar - QR-Asist{% endblock %}

{% block header %}ConsolidaciÃ³n y Reportes{% endblock %}

{% block content %}
<div class="consolidar-section">

    <!-- SecciÃ³n: ConsolidaciÃ³n -->
    <div class="card">
        <h3>ğŸ”„ Consolidar Archivos</h3>
        <p class="help-text">Procesa los archivos de asistencia y genera consolidados diarios</p>

        <div class="stats-grid" style="margin-bottom: 1.5rem;">
            <div class="stat-item">
                <div class="stat-label">Carpeta Activa</div>
                <div class="stat-value" id="carpetaActiva" style="font-size: 0.875rem;">-</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Consolidados</div>
                <div class="stat-value" id="totalConsolidados">0</div>
            </div>
        </div>

        <div class="actions-grid">
            <button id="btnConsolidar" class="btn btn-primary">
                <span class="icon">âš¡</span>
                Consolidar Todo
            </button>
            <button id="btnForzarConsolidar" class="btn btn-secondary">
                <span class="icon">ğŸ”„</span>
                Forzar Re-consolidaciÃ³n
            </button>
        </div>

        <div id="estadoConsolidacion" class="card estado-card" style="display: none; margin-top: 1rem;">
            <div id="estadoConsolidacionContenido"></div>
        </div>
    </div>

    <!-- SecciÃ³n: Filtros -->
    <div class="card">
        <h3>ğŸ” Filtros de BÃºsqueda</h3>

        <div class="form-grid">
            <div class="form-group">
                <label for="fechaInicio">Fecha Inicio:</label>
                <input type="date" id="fechaInicio" class="form-input">
            </div>

            <div class="form-group">
                <label for="fechaFin">Fecha Fin:</label>
                <input type="date" id="fechaFin" class="form-input">
            </div>

            <div class="form-group">
                <label for="horaLimite">Hora LÃ­mite (Tardanzas):</label>
                <input type="time" id="horaLimite" class="form-input" value="08:00">
            </div>

            <div class="form-group">
                <label for="buscarAlumno">Buscar Alumno:</label>
                <input type="text" id="buscarAlumno" class="form-input" placeholder="Nombre o ID...">
            </div>

            <div class="form-group">
                <label for="filtroNivel">Nivel:</label>
                <select id="filtroNivel" class="form-input">
                    <option value="">Todos los niveles</option>
                </select>
            </div>

            <div class="form-group">
                <label for="filtroGrado">Grado:</label>
                <select id="filtroGrado" class="form-input">
                    <option value="">Todos los grados</option>
                </select>
            </div>

            <div class="form-group">
                <label for="filtroSeccion">SecciÃ³n:</label>
                <select id="filtroSeccion" class="form-input">
                    <option value="">Todas las secciones</option>
                </select>
            </div>
        </div>

        <div class="actions-grid" style="margin-top: 1rem;">
            <button id="btnCargarDatos" class="btn btn-primary">
                <span class="icon">ğŸ“¥</span>
                Cargar Datos
            </button>
            <button id="btnAplicarFiltros" class="btn btn-secondary" disabled>
                <span class="icon">ğŸ”</span>
                Aplicar Filtros
            </button>
            <button id="btnLimpiarFiltros" class="btn btn-secondary" disabled>
                <span class="icon">ğŸ—‘ï¸</span>
                Limpiar Filtros
            </button>
        </div>
    </div>

    <!-- SecciÃ³n: EstadÃ­sticas -->
    <div class="card">
        <h3>ğŸ“Š EstadÃ­sticas</h3>

        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-label">Total Registros</div>
                <div class="stat-value" id="statTotal">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Tardanzas</div>
                <div class="stat-value" id="statTardanzas" style="color: var(--warning);">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Alumnos Ãšnicos</div>
                <div class="stat-value" id="statAlumnos">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">DÃ­as Cargados</div>
                <div class="stat-value" id="statDias">0</div>
            </div>
        </div>
    </div>

    <!-- SecciÃ³n: Tabla de Resultados -->
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h3 style="margin: 0;">ğŸ“‹ Resultados</h3>
            <button id="btnExportar" class="btn btn-success" disabled>
                <span class="icon">ğŸ“¥</span>
                Descargar Excel
            </button>
        </div>

        <div id="tablaContainer">
            <p class="empty-state">Carga datos seleccionando un rango de fechas y presionando "Cargar Datos"</p>
        </div>

        <!-- PaginaciÃ³n -->
        <div id="paginacion" style="display: none; margin-top: 1rem; text-align: center;">
            <button id="btnPaginaAnterior" class="btn btn-small btn-secondary">â† Anterior</button>
            <span id="infoPagina" style="margin: 0 1rem;">PÃ¡gina 1 de 1</span>
            <button id="btnPaginaSiguiente" class="btn btn-small btn-secondary">Siguiente â†’</button>
        </div>
    </div>

</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/consolidar.js') }}"></script>
{% endblock %}